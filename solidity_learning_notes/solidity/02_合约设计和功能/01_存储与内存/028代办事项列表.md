# 代办事项列表

在Solidity中，代办事项列表（To-Do List）指的是智能合约中用于管理待办事项的数据结构，用于追踪任务状态（如待办/已完成）。每个待办事项通常包含一些基本信息，比如内容、是否完成等。我们可以使用结构体（struct）来定义单个待办事项，然后使用数组（array）或者映射（mapping）来存储多个待办事项。

构建一个简单的代办事项列表合约：

1. 定义结构体：表示一个待办事项，通常包含：

- id：唯一标识

- content：事项内容（字符串）

- completed：是否已完成（布尔值）

2. 存储待办事项：使用数组来存储所有待办事项，也可以使用映射来根据id快速查找。这里为了简单，我们使用数组。同时，我们也可以使用一个映射来跟踪每个地址的待办事项（即每个用户有自己的待办事项列表），但为了简单，我们先不考虑用户，先做一个全局的待办事项列表。

3. 功能函数：

- 添加待办事项

- 标记为完成（或未完成）

- 获取待办事项（可以获取全部，或者根据id获取）

4. 事件：为了前端能够监听状态变化，定义一些事件，比如添加事件、更新完成状态事件等。

## 核心数据结构

### 结构体（Struct）

定义单个任务的基本属性：

```solidity
struct Todo {
    uint id;          // 任务唯一ID
    string content;   // 任务描述
    bool completed;  // 完成状态（false=待办，true=已完成）
}
```

### 存储结构

- 数组（Array）：按顺序存储所有任务

```solidity
Todo[] public todos;
```

- 映射（Mapping）：快速按ID查询任务（可选）

```solidity
mapping(uint => Todo) public todoMap;
```

## 核心功能实现

### 添加任务

```solidity
function createTodo(string memory _content) public {
    uint id = todos.length; // 自动生成ID
    todos.push(Todo(id,_content, false)); // 初始状态为false
    // 若使用映射：todoMap[id] = Todo(id, _content, false);
    emit TodoCreated(id,_content);
}
```

### 标记任务状态

```solidity
function toggleCompleted(uint _id) public {
    require(_id < todos.length, "任务不存在");
    Todo storage todo = todos[_id]; // 修改存储中的任务
    todo.completed = !todo.completed; // 切换状态
    emit TodoToggled(_id, todo.completed);
}
```

### 查询任务

- 查询单个任务（通过数组索引）：

```solidity
function getTodo(uint _id) public view returns (uint, string memory, bool) {
    Todo memory todo = todos[_id];
    return (todo.id, todo.content, todo.completed);
}
```

- 查询全部任务数量：

```solidity
function getTodoCount() public view returns (uint) {
    return todos.length;
}
```

## 完整合约示例

```solidity
pragma solidity ^0.8.0;

contract TodoList {
    event TodoCreated(uint id, string content);
    event TodoToggled(uint id, bool completed);

    struct Todo {
        uint id;
        string content;
        bool completed;
    }

    Todo[] public todos;

    // 添加任务
    function createTodo(string memory _content) public {
        uint id = todos.length;
        todos.push(Todo(id, _content, false));
        emit TodoCreated(id, _content);
    }

    // 切换任务状态
    function toggleCompleted(uint _id) public {
        require(_id < todos.length, "Invalid ID");
        Todo storage todo = todos[_id];
        todo.completed = !todo.completed;
        emit TodoToggled(_id, todo.completed);
    }

    // 获取任务总数
    function getTodoCount() public view returns (uint) {
        return todos.length;
    }
}
```

## 前端交互示例（使用 ethers.js）

```javascript
// 连接合约
const contractAddress = "0x...";
const abi = [...]; // 合约ABI
const todoContract = new ethers.Contract(contractAddress, abi, signer);

// 添加任务
await todoContract.createTodo("学习Solidity");

// 标记任务为完成
await todoContract.toggleCompleted(0); // 切换ID=0的任务状态

// 查询任务
const taskCount = await todoContract.getTodoCount();
const task = await todoContract.todos(0); // 查询ID=0的任务
console.log(`任务内容: ${task.content}, 状态: ${task.completed ? "已完成" : "待办"}`);
```

## 注意事项

- Gas 成本优化

- - 避免存储大文本（如长描述），优先用string存简短内容

- - 考虑用事件（Event）替代直接返回数组（减少链上计算）

- 权限控制
添加修饰符限制关键操作（如仅允许创建者修改任务）：

```solidity
modifier onlyOwner(uint _id) {
    require(msg.sender == taskOwner[_id], "无权限");
    _;
}

function toggleCompleted(uint _id) public onlyOwner(_id) { ... }
```

- 数据扩展

- - 添加截止时间：uint deadline

- - 添加优先级：enum Priority { Low, Medium, High }

- - 任务分类：mapping(string => Todo[]) categoryTasks

## 适用场景

- 去中心化任务管理 DApp

- DAO 组织的提案追踪

- 游戏任务进度记录

- 供应链状态跟踪

通过此模式，可构建出具备完整 CRUD（创建、读取、更新、状态切换）功能的链上任务管理系统。
