# erc20

åœ¨ Solidity ä¸­ï¼ŒERC20 æ˜¯ä»¥å¤ªåŠä¸Šæœ€å¹¿æ³›ä½¿ç”¨çš„ä»£å¸æ ‡å‡†ï¼ˆToken Standardï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€å¥—è§„åˆ™å’Œæ¥å£ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿåˆ›å»ºå¯äº’æ“ä½œçš„ã€å…¼å®¹é’±åŒ…/äº¤æ˜“æ‰€çš„ä»£å¸ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒè¦ç‚¹ï¼š

## æ ¸å¿ƒç‰¹æ€§

### æ ‡å‡†åŒ–æ¥å£

æ‰€æœ‰ ERC20 ä»£å¸éƒ½éµå¾ªç›¸åŒçš„å‡½æ•°å’Œäº‹ä»¶å‘½åï¼Œç¡®ä¿å®ƒä»¬èƒ½ä¸é’±åŒ…ï¼ˆå¦‚ MetaMaskï¼‰ã€äº¤æ˜“æ‰€ï¼ˆå¦‚ Coinbaseï¼‰å’Œ DeFi åè®®ï¼ˆå¦‚ Uniswapï¼‰æ— ç¼äº¤äº’ã€‚

### åŸºæœ¬åŠŸèƒ½

ä»£å¸è½¬è´¦ï¼ˆtransferï¼‰

ä½™é¢æŸ¥è¯¢ï¼ˆbalanceOfï¼‰

æˆæƒå…¶ä»–åœ°å€ä½¿ç”¨ä»£å¸ï¼ˆapprove + transferFromï¼‰

æŸ¥è¯¢æˆæƒé¢åº¦ï¼ˆallowanceï¼‰

## å¿…é€‰å‡½æ•°ï¼ˆ6ä¸ªï¼‰

```solidity
// 1. è·å–ä»£å¸æ€»ä¾›åº”é‡
function totalSupply() external view returns (uint256);

// 2. æŸ¥è¯¢åœ°å€ä½™é¢
function balanceOf(address account) external view returns (uint256);

// 3. è½¬è´¦ç»™ä»–äºº
function transfer(address recipient, uint256 amount) external returns (bool);

// 4. æŸ¥è¯¢æˆæƒé¢åº¦ï¼ˆA å…è®¸ B èŠ±å¤šå°‘ä»£å¸ï¼‰
function allowance(address owner, address spender) external view returns (uint256);

// 5. æˆæƒä»–äººä½¿ç”¨è‡ªå·±çš„ä»£å¸
function approve(address spender, uint256 amount) external returns (bool);

// 6. ä»£è¡¨ä»–äººè½¬è´¦ï¼ˆéœ€æå‰æˆæƒï¼‰
function transferFrom(address sender, address recipient, uint256 amount) external returns (bool);
```

## å¿…é€‰äº‹ä»¶ï¼ˆ2ä¸ªï¼‰

```solidity
// è½¬è´¦æ—¶è§¦å‘
event Transfer(address indexed from, address indexed to, uint256 value);

// æˆæƒæ—¶è§¦å‘
event Approval(address indexed owner, address indexed spender, uint256 value);
```

## å¯é€‰å­—æ®µï¼ˆå¸¸ç”¨ï¼‰

```solidity
string public name;     // ä»£å¸åç§° (e.g., "My Token")
string public symbol;   // ä»£å¸ç¬¦å· (e.g., "MTK")
uint8 public decimals;  // å°æ•°ä½æ•° (e.g., 18ï¼Œè¡¨ç¤º 1 ä»£å¸ = 10Â¹â¸ æœ€å°å•ä½)
```

## å…¸å‹å·¥ä½œæµ

### è½¬è´¦

```solidity
token.transfer(receiver, 100); // ç›´æ¥è½¬è´¦
```

### æˆæƒ+ä»£ç†è½¬è´¦

```solidity
token.approve(spender, 100);          // æˆæƒç»™ spender
token.transferFrom(owner, receiver, 50); // spender ä»£ç†è½¬è´¦
```

## é‡è¦æ€§

äº’æ“ä½œæ€§ï¼šæ‰€æœ‰ ERC20 ä»£å¸å…±äº«ç›¸åŒæ¥å£ï¼Œå¯è¢«ç»Ÿä¸€æ”¯æŒã€‚

ç”Ÿæ€å…¼å®¹ï¼šäº¤æ˜“æ‰€/é’±åŒ…åªéœ€é›†æˆä¸€æ¬¡æ ‡å‡†å³å¯æ”¯æŒæ‰€æœ‰ ERC20 ä»£å¸ã€‚

DeFi åŸºç¡€ï¼šæ˜¯å€Ÿè´·åè®®ï¼ˆAaveï¼‰ã€äº¤æ˜“æ‰€ï¼ˆUniswapï¼‰ç­‰çš„åŸºç¡€ç»„ä»¶ã€‚

## å®‰å…¨æ³¨æ„äº‹é¡¹

é‡å…¥æ”»å‡»ï¼šæ—§ç‰ˆæœ¬ Solidity éœ€ç”¨ Checks-Effects-Interactions æ¨¡å¼é˜²æŠ¤ã€‚

æˆæƒé£é™©ï¼šè¿‡åº¦æˆæƒå¯èƒ½å¯¼è‡´èµ„äº§è¢«ç›—ï¼ˆå¦‚æˆæƒåæ¶æ„åˆçº¦è½¬èµ°ä»£å¸ï¼‰ã€‚

ç²¾åº¦å¤„ç†ï¼šè®¡ç®—æ—¶éœ€è€ƒè™‘ decimalsï¼ˆå¦‚ 1 ETH = 10Â¹â¸ weiï¼‰ã€‚

## ç®€å•ç¤ºä¾‹ä»£ç 

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract MyToken {
    string public name = "MyToken";
    string public symbol = "MTK";
    uint8 public decimals = 18;
    uint256 public totalSupply = 1000000 * 10**uint256(decimals);

    mapping(address => uint256) public balanceOf;
    mapping(address => mapping(address => uint256)) public allowance;

    event Transfer(address indexed from, address indexed to, uint256 value);
    event Approval(address indexed owner, address indexed spender, uint256 value);

    constructor() {
        balanceOf[msg.sender] = totalSupply;
    }

    function transfer(address recipient, uint256 amount) external returns (bool) {
        require(balanceOf[msg.sender] >= amount, "Insufficient balance");
        balanceOf[msg.sender] -= amount;
        balanceOf[recipient] += amount;
        emit Transfer(msg.sender, recipient, amount);
        return true;
    }

    function approve(address spender, uint256 amount) external returns (bool) {
        allowance[msg.sender][spender] = amount;
        emit Approval(msg.sender, spender, amount);
        return true;
    }

    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool) {
        require(allowance[sender][msg.sender] >= amount, "Allowance exceeded");
        require(balanceOf[sender] >= amount, "Insufficient balance");
        allowance[sender][msg.sender] -= amount;
        balanceOf[sender] -= amount;
        balanceOf[recipient] += amount;
        emit Transfer(sender, recipient, amount);
        return true;
    }
}
```

ğŸ“Œ æç¤ºï¼šå®é™…å¼€å‘æ¨èä½¿ç”¨ OpenZeppelin çš„æ ‡å‡† ERC20 å®ç°ï¼Œå®ƒç»è¿‡å……åˆ†å®¡è®¡å¹¶åŒ…å«å®‰å…¨åŠŸèƒ½ã€‚

é€šè¿‡éµå¾ª ERC20 æ ‡å‡†ï¼Œä»£å¸å¯æ— ç¼èå…¥ä»¥å¤ªåŠç”Ÿæ€ï¼Œæˆä¸º DeFiã€NFT ç­‰é¡¹ç›®çš„åŸºç¡€è®¾æ–½ã€‚
