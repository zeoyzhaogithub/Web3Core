# erc721

åœ¨ Solidity ä¸­ï¼ŒERC721 æ˜¯ä»¥å¤ªåŠä¸Šç”¨äºåˆ›å»ºå’Œç®¡ç†éåŒè´¨åŒ–ä»£å¸ï¼ˆNon-Fungible Token, NFTï¼‰çš„æ ‡å‡†æ™ºèƒ½åˆçº¦æ¥å£ã€‚

å®ƒç”± EIP-721ï¼ˆEthereum Improvement Proposal 721ï¼‰æ­£å¼å®šä¹‰ã€‚ç†è§£ ERC721 çš„å…³é”®åœ¨äºâ€œéåŒè´¨åŒ–â€è¿™ä¸ªæ¦‚å¿µï¼š

## éåŒè´¨åŒ–ï¼ˆNon-Fungibleï¼‰

æ„å‘³ç€æ¯ä¸ªä»£å¸éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œå…·æœ‰ç‹¬ç‰¹æ€§ã€‚

ä¸å¯äº’æ¢ï¼šä¸€ä¸ª ERC721 ä»£å¸ä¸èƒ½ç®€å•åœ°ä¸å¦ä¸€ä¸ª ERC721 ä»£å¸è¿›è¡Œâ€œ1:1â€äº¤æ¢ï¼Œå› ä¸ºå®ƒä»¬ä»£è¡¨çš„æ˜¯ä¸åŒçš„ä¸œè¥¿ï¼Œæ‹¥æœ‰ä¸åŒçš„å±æ€§å’Œä»·å€¼ã€‚

ä¸åŒè´¨åŒ–ä»£å¸ï¼ˆå¦‚ ERC20 ä»£å¸æˆ–ç°å®ä¸­çš„è´§å¸ï¼‰å½¢æˆé²œæ˜å¯¹æ¯”ã€‚åŒè´¨åŒ–ä»£å¸æ˜¯ç›¸åŒçš„ï¼Œå¯ä»¥äº’ç›¸æ›¿ä»£ï¼ˆä¾‹å¦‚ï¼Œä½ çš„ 1 ETH å’Œæˆ‘çš„ 1 ETH ä»·å€¼ç›¸åŒï¼Œå¯ä»¥äº’æ¢ï¼‰ã€‚

## ä»£è¡¨ç‹¬ç‰¹èµ„äº§

### æ¯ä¸ª ERC721 ä»£å¸é€šå¸¸ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„ã€å”¯ä¸€çš„æ•°å­—æˆ–ç‰©ç†èµ„äº§çš„æ‰€æœ‰æƒæˆ–è¯æ˜

### å¸¸è§åº”ç”¨åœºæ™¯åŒ…æ‹¬

æ•°å­—æ”¶è—å“å’Œè‰ºæœ¯å“ï¼šå¦‚ CryptoKitties, CryptoPunks, Bored Ape Yacht Club (BAYC) ç­‰ã€‚

æ¸¸æˆå†…ç‰©å“ï¼šç‹¬ç‰¹çš„æ­¦å™¨ã€çš®è‚¤ã€è§’è‰²ã€è™šæ‹ŸåœŸåœ°ç­‰ã€‚

è™šæ‹Ÿæˆ¿åœ°äº§ï¼šå¦‚ Decentraland æˆ– The Sandbox ä¸­çš„åœ°å—ã€‚

åŸŸåç³»ç»Ÿï¼šå¦‚ ENSï¼ˆä»¥å¤ªåŠåŸŸåæœåŠ¡ï¼‰çš„ .eth åŸŸåã€‚

ç°å®ä¸–ç•Œèµ„äº§çš„ä»£å¸åŒ–ï¼šå¦‚ç‹¬ç‰¹çš„è‰ºæœ¯å“ã€æ”¶è—å“ã€æˆ¿äº§ç­‰çš„æ‰€æœ‰æƒè¯æ˜ï¼ˆè™½ç„¶éœ€è¦é“¾ä¸‹æ³•å¾‹æ¡†æ¶é…åˆï¼‰ã€‚

ä¼šå‘˜èµ„æ ¼å’Œé—¨ç¥¨ï¼šç‹¬ç‰¹çš„è®¿é—®æƒé™è¯æ˜ã€‚

èº«ä»½å’Œè®¤è¯ï¼šç‹¬ç‰¹çš„èº«ä»½å‡­è¯ã€‚

## ERC721 æ ‡å‡†çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆæ¥å£ï¼‰

Solidity ä¸­çš„ ERC721 åˆçº¦å¿…é¡»å®ç°ä¸€ç»„æ ¸å¿ƒå‡½æ•°ï¼Œä»¥ä¾¿é’±åŒ…ã€äº¤æ˜“æ‰€ã€å¸‚åœºå’Œå…¶ä»–æ™ºèƒ½åˆçº¦èƒ½å¤Ÿä¸€è‡´åœ°ä¸ä»»ä½• NFT è¿›è¡Œäº¤äº’ã€‚æ ¸å¿ƒå‡½æ•°åŒ…æ‹¬ï¼š

balanceOf(address _owner) external view returns (uint256): æŸ¥è¯¢æŒ‡å®šåœ°å€æ‹¥æœ‰çš„ä»£å¸æ•°é‡ã€‚

ownerOf(uint256 _tokenId) external view returns (address): æŸ¥è¯¢æŒ‡å®šä»£å¸ ID (_tokenId) çš„å½“å‰æ‰€æœ‰è€…åœ°å€ã€‚

safeTransferFrom(address _from, address_to, uint256 _tokenId, bytes data) external payable: å®‰å…¨åœ°å°†ä»£å¸æ‰€æœ‰æƒä»ä¸€ä¸ªåœ°å€è½¬ç§»åˆ°å¦ä¸€ä¸ªåœ°å€ã€‚data å‚æ•°å¯é€‰ï¼Œé€šå¸¸ä¸ºç©ºã€‚è¿™ä¸ªç‰ˆæœ¬ä¼šæ£€æŸ¥æ¥æ”¶åœ°å€æ˜¯å¦æ˜¯åˆçº¦ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨å…¶ onERC721Received å‡½æ•°ï¼Œé˜²æ­¢ä»£å¸è¢«æ°¸ä¹…é”å®šåœ¨æ— æ³•å¤„ç†å®ƒçš„åˆçº¦ä¸­ã€‚

safeTransferFrom(address _from, address_to, uint256 _tokenId) external payable: ä¸Šé¢å‡½æ•°çš„é‡è½½ï¼Œä¸å¸¦ data å‚æ•°ã€‚

transferFrom(address _from, address_to, uint256 _tokenId) external payable: è½¬ç§»ä»£å¸æ‰€æœ‰æƒï¼ˆåŸºæœ¬ç‰ˆæœ¬ï¼‰ã€‚é€šå¸¸æ›´æ¨èä½¿ç”¨ safeTransferFromã€‚

approve(address _approved, uint256_tokenId) external payable: æˆæƒå¦ä¸€ä¸ªåœ°å€ï¼ˆæ“ä½œå‘˜ï¼‰ä»£è¡¨ä½ ç®¡ç†ï¼ˆè½¬ç§»ï¼‰ä½ æ‹¥æœ‰çš„ç‰¹å®šä»£å¸ã€‚

setApprovalForAll(address _operator, bool_approved) external: æˆæƒæˆ–æ’¤é”€å¦ä¸€ä¸ªåœ°å€ï¼ˆæ“ä½œå‘˜ï¼‰ä»£è¡¨ä½ ç®¡ç†ï¼ˆè½¬ç§»ï¼‰ä½ æ‹¥æœ‰çš„æ‰€æœ‰ä»£å¸ã€‚

getApproved(uint256 _tokenId) external view returns (address): æŸ¥è¯¢è¢«æˆæƒç®¡ç†ç‰¹å®šä»£å¸çš„åœ°å€ï¼ˆç”± approve è®¾ç½®ï¼‰ã€‚

isApprovedForAll(address _owner, address_operator) external view returns (bool): æ£€æŸ¥ä¸€ä¸ªæ“ä½œå‘˜æ˜¯å¦è¢«æˆæƒç®¡ç†æŸä¸ªæ‰€æœ‰è€…æ‹¥æœ‰çš„æ‰€æœ‰ä»£å¸ï¼ˆç”± setApprovalForAll è®¾ç½®ï¼‰ã€‚

## å¯é€‰æ‰©å±•æ¥å£

ä¸ºäº†å¢å¼ºåŠŸèƒ½ï¼ŒERC721 æ ‡å‡†è¿˜å®šä¹‰äº†å¸¸ç”¨çš„å¯é€‰æ‰©å±•æ¥å£ï¼š

### ERC721Metadata

name() external view returns (string memory): è¿”å›ä»£å¸é›†åˆçš„åç§°ï¼ˆä¾‹å¦‚ "Bored Ape Yacht Club"ï¼‰ã€‚

symbol() external view returns (string memory): è¿”å›ä»£å¸é›†åˆçš„ç¬¦å·ï¼ˆä¾‹å¦‚ "BAYC"ï¼‰ã€‚

tokenURI(uint256 _tokenId) external view returns (string memory): è¿”å›æŒ‡å‘æè¿°è¯¥ç‰¹å®šä»£å¸çš„å…ƒæ•°æ® JSON æ–‡ä»¶çš„ URIï¼ˆé€šå¸¸æ˜¯ HTTP æˆ– IPFS é“¾æ¥ï¼‰ã€‚è¿™ä¸ª JSON æ–‡ä»¶åŒ…å«äº†ä»£å¸çš„åç§°ã€æè¿°ã€å›¾åƒ/åª’ä½“é“¾æ¥ã€å±æ€§ï¼ˆattributesï¼‰ç­‰å…³é”®ä¿¡æ¯ã€‚è¿™æ˜¯ NFT é¡¹ç›®æœ€å¸¸è§çš„æ‰©å±•ã€‚

### ERC721Enumerable

æä¾›éå†ä»£å¸çš„åŠŸèƒ½ï¼Œå¯¹äºéœ€è¦åˆ—å‡ºæ‰€æœ‰ä»£å¸æˆ–ç”¨æˆ·ä»£å¸çš„ DApp å¾ˆæœ‰ç”¨ã€‚

totalSupply() external view returns (uint256): è¿”å›ä»£å¸çš„æ€»ä¾›åº”é‡ï¼ˆå¦‚æœå®ç°äº†ï¼‰ã€‚

tokenByIndex(uint256 _index) external view returns (uint256): æŒ‰ç´¢å¼•è¿”å›ä»£å¸ IDã€‚

tokenOfOwnerByIndex(address _owner, uint256_index) external view returns (uint256): æŒ‰ç´¢å¼•è¿”å›æŒ‡å®šæ‰€æœ‰è€…æ‹¥æœ‰çš„ä»£å¸ IDã€‚

## äº‹ä»¶ï¼ˆEventsï¼‰

åˆçº¦ä¼šåœ¨çŠ¶æ€æ”¹å˜æ—¶è§¦å‘äº‹ä»¶ï¼Œä¾›å¤–éƒ¨ç›‘å¬ï¼š

Transfer(address indexed from, address indexed to, uint256 indexed tokenId): å½“ä»£å¸æ‰€æœ‰æƒè½¬ç§»æ—¶è§¦å‘ã€‚

Approval(address indexed owner, address indexed approved, uint256 indexed tokenId): å½“ä½¿ç”¨ approve ä¸ºç‰¹å®šä»£å¸è®¾ç½®æˆæƒæ—¶è§¦å‘ã€‚

ApprovalForAll(address indexed owner, address indexed operator, bool approved): å½“ä½¿ç”¨ setApprovalForAll è®¾ç½®æˆ–æ’¤é”€å…¨å±€æ“ä½œå‘˜æˆæƒæ—¶è§¦å‘ã€‚

## æ€»ç»“

åœ¨ Solidity çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒERC721 æ˜¯ä¸€ä¸ªæ ‡å‡†è§„èŒƒï¼ˆä¸€ç»„å¿…é¡»å®ç°çš„å‡½æ•°å’Œäº‹ä»¶ï¼‰ã€‚å¼€å‘è€…é€šè¿‡ç¼–å†™ç¬¦åˆè¿™ä¸ªè§„èŒƒçš„æ™ºèƒ½åˆçº¦æ¥åˆ›å»ºè‡ªå·±çš„ NFT é¡¹ç›®ã€‚å®ƒç¡®ä¿äº†æ‰€æœ‰åŸºäº ERC721 çš„ NFT éƒ½èƒ½è¢«å…¼å®¹çš„é’±åŒ…ï¼ˆå¦‚ MetaMaskï¼‰ã€å¸‚åœºï¼ˆå¦‚ OpenSea, Blurï¼‰å’Œå…¶ä»–åº”ç”¨ç¨‹åºä»¥ä¸€è‡´çš„æ–¹å¼è¯†åˆ«ã€å±•ç¤ºã€è½¬ç§»å’Œäº¤æ˜“ï¼Œæå¤§åœ°ä¿ƒè¿›äº† NFT ç”Ÿæ€ç³»ç»Ÿçš„äº’æ“ä½œæ€§å’Œç¹è£ã€‚

ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯åˆ›å»ºç‹¬ç‰¹æ•°å­—ç‰©å“ï¼ˆNFTï¼‰çš„â€œè“å›¾â€æˆ–â€œè§„åˆ™æ‰‹å†Œâ€ï¼Œä»»ä½•éµå¾ªè¿™äº›è§„åˆ™ç¼–å†™çš„ Solidity åˆçº¦éƒ½èƒ½ç”Ÿäº§å‡ºè¢«æ•´ä¸ªä»¥å¤ªåŠ NFT ç”Ÿæ€ç³»ç»Ÿç†è§£çš„ä»£å¸ã€‚

---

# ERC721æ ‡å‡†æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨æŒ‡å—

ERC721æ˜¯ä»¥å¤ªåŠä¸Šç”¨äºéåŒè´¨åŒ–ä»£å¸(NFT)çš„æ ‡å‡†æ¥å£ã€‚ä¸‹é¢æˆ‘å°†é€šè¿‡ä¸€ä¸ªäº¤äº’å¼ç¤ºä¾‹å±•ç¤ºERC721æ ¸å¿ƒåŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•ã€‚

## ERC721æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°

ä»¥ä¸‹æ˜¯ERC721æ ‡å‡†çš„æ ¸å¿ƒåŠŸèƒ½åŠå…¶ä½¿ç”¨æ–¹æ³•ï¼š

åŠŸèƒ½| æ–¹æ³•ç­¾å| æè¿°
|---|-------|----|
æŸ¥è¯¢ä½™é¢| balanceOf(address owner) |æŸ¥è¯¢æŒ‡å®šåœ°å€æ‹¥æœ‰çš„NFTæ•°é‡
æŸ¥è¯¢æ‰€æœ‰è€…| ownerOf(uint256 tokenId)| æŸ¥è¯¢ç‰¹å®šNFTçš„æ‰€æœ‰è€…
è½¬ç§»ä»£å¸| transferFrom(address from, address to, uint256 tokenId) |è½¬ç§»NFTæ‰€æœ‰æƒ
å®‰å…¨è½¬ç§»| safeTransferFrom(address from, address to, uint256 tokenId)| å®‰å…¨è½¬ç§»(æ£€æŸ¥æ¥æ”¶åˆçº¦)
æˆæƒç®¡ç†| approve(address to, uint256 tokenId)| æˆæƒåœ°å€ç®¡ç†ç‰¹å®šNFT
å…¨å±€æˆæƒ |setApprovalForAll(address operator, bool approved) |æˆæƒ/æ’¤é”€åœ°å€ç®¡ç†æ‰€æœ‰NFT
æŸ¥è¯¢æˆæƒ| getApproved(uint256 tokenId) |æŸ¥è¯¢ç‰¹å®šNFTçš„æˆæƒåœ°å€
æŸ¥è¯¢å…¨å±€æˆæƒ| isApprovedForAll(address owner, address operator) |æŸ¥è¯¢å…¨å±€æˆæƒçŠ¶æ€

## äº¤äº’å¼ç¤ºä¾‹

```html

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERC721æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º</title>
    <style>
        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --dark: #1a1c2c;
            --light: #f5f5f7;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            padding: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.5);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            align-items: center;
        }
        
        .card h2 i {
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .function-demo {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        button {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary);
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .token-visualization {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .token {
            width: 120px;
            height: 160px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .token-id {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .token-owner {
            font-size: 14px;
            text-align: center;
            background: rgba(0,0,0,0.3);
            padding: 4px 8px;
            border-radius: 20px;
        }
        
        .token-approved {
            position: absolute;
            bottom: 10px;
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
        }
        
        .success {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }
        
        .error {
            background-color: rgba(244, 67, 54, 0.2);
            color: var(--error);
        }
        
        .info {
            background-color: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
        }
        
        .code-comment {
            color: #75715e;
        }
        
        .code-keyword {
            color: #f92672;
        }
        
        .code-function {
            color: #66d9ef;
        }
        
        .code-var {
            color: #fd971f;
        }
        
        .code-string {
            color: #e6db74;
        }
        
        @media (max-width: 768px) {
            .cards-container {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            header p {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ERC721 æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º</h1>
            <p>äº†è§£å¦‚ä½•é€šè¿‡æ™ºèƒ½åˆçº¦äº¤äº’ä½¿ç”¨ ERC721 æ ‡å‡†çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ NFT çš„è½¬ç§»ã€æˆæƒå’ŒæŸ¥è¯¢æ“ä½œã€‚</p>
        </header>

        <div class="token-visualization">
            <div class="token">
                <div class="token-id">NFT #1</div>
                <div class="token-owner">æ‰€æœ‰è€…: 0x1234...abcd</div>
                <div class="token-approved">æˆæƒ: 0x5678...ef01</div>
            </div>
        </div>
        
        <div class="cards-container">
            <!-- æŸ¥è¯¢åŠŸèƒ½ -->
            <div class="card">
                <h2>ğŸ“‹ æŸ¥è¯¢åŠŸèƒ½</h2>
                <p>æŸ¥è¯¢ NFT çš„æ‰€æœ‰æƒå’Œä½™é¢ä¿¡æ¯</p>
                
                <div class="function-demo">
                    <div class="input-group">
                        <label for="ownerAddress">æ‰€æœ‰è€…åœ°å€</label>
                        <input type="text" id="ownerAddress" value="0x1234567890abcdef1234567890abcdef12345678">
                    </div>
                    
                    <div class="input-group">
                        <label for="tokenId">ä»£å¸ ID</label>
                        <input type="text" id="tokenId" value="1">
                    </div>
                    
                    <button onclick="queryFunctions()">æ‰§è¡ŒæŸ¥è¯¢</button>
                    
                    <div class="result" id="queryResult">
                        {/* ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ */}
                    </div>
                </div>
            </div>
            
            <!-- è½¬ç§»åŠŸèƒ½ -->
            <div class="card">
                <h2>ğŸ”„ è½¬ç§»åŠŸèƒ½</h2>
                <p>è½¬ç§» NFT çš„æ‰€æœ‰æƒ</p>
                
                <div class="function-demo">
                    <div class="input-group">
                        <label for="fromAddress">å‘é€æ–¹åœ°å€</label>
                        <input type="text" id="fromAddress" value="0x1234567890abcdef1234567890abcdef12345678">
                    </div>
                    
                    <div class="input-group">
                        <label for="toAddress">æ¥æ”¶æ–¹åœ°å€</label>
                        <input type="text" id="toAddress" value="0xabcdef1234567890abcdef1234567890abcdef12">
                    </div>
                    
                    <div class="input-group">
                        <label for="transferTokenId">ä»£å¸ ID</label>
                        <input type="text" id="transferTokenId" value="1">
                    </div>
                    
                    <div class="input-group">
                        <label for="transferType">è½¬ç§»ç±»å‹</label>
                        <select id="transferType">
                            <option value="transferFrom">transferFrom</option>
                            <option value="safeTransferFrom">safeTransferFrom</option>
                        </select>
                    </div>
                    
                    <button onclick="transferNFT()">è½¬ç§» NFT</button>
                    
                    <div class="result" id="transferResult">
                        {/* ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ */}
                    </div>
                </div>
            </div>
            
            <!-- æˆæƒåŠŸèƒ½ -->
            <div class="card">
                <h2>ğŸ”‘ æˆæƒåŠŸèƒ½</h2>
                <p>æˆæƒå…¶ä»–åœ°å€ç®¡ç†æ‚¨çš„ NFT</p>
                
                <div class="function-demo">
                    <div class="input-group">
                        <label for="approveType">æˆæƒç±»å‹</label>
                        <select id="approveType" onchange="toggleApprovalFields()">
                            <option value="single">å•ä¸ªæˆæƒ (approve)</option>
                            <option value="all">å…¨å±€æˆæƒ (setApprovalForAll)</option>
                        </select>
                    </div>
                    
                    <div id="singleApprovalFields">
                        <div class="input-group">
                            <label for="approveTo">æˆæƒåœ°å€</label>
                            <input type="text" id="approveTo" value="0x567890abcdef1234567890abcdef1234567890ab">
                        </div>
                        
                        <div class="input-group">
                            <label for="approveTokenId">ä»£å¸ ID</label>
                            <input type="text" id="approveTokenId" value="1">
                        </div>
                    </div>
                    
                    <div id="allApprovalFields" style="display:none;">
                        <div class="input-group">
                            <label for="operator">æ“ä½œå‘˜åœ°å€</label>
                            <input type="text" id="operator" value="0x567890abcdef1234567890abcdef1234567890ab">
                        </div>
                        
                        <div class="input-group">
                            <label for="approvalStatus">æˆæƒçŠ¶æ€</label>
                            <select id="approvalStatus">
                                <option value="true">æˆæƒ</option>
                                <option value="false">æ’¤é”€æˆæƒ</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="manageApproval()">æ‰§è¡Œæˆæƒ</button>
                    
                    <div class="result" id="approvalResult">
                        {/* ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ */}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="code-block">
            <pre><code><span class="code-comment">// ERC721 æ ¸å¿ƒåŠŸèƒ½ Solidity æ¥å£</span>
<span class="code-keyword">interface</span> <span class="code-function">IERC721</span> {
    <span class="code-comment">// æŸ¥è¯¢æ‰€æœ‰è€…æ‹¥æœ‰çš„ NFT æ•°é‡</span>
    <span class="code-keyword">function</span> <span class="code-function">balanceOf</span>(<span class="code-keyword">address</span> owner) <span class="code-keyword">external</span> <span class="code-keyword">view</span> <span class="code-keyword">returns</span> (<span class="code-keyword">uint256</span>);

    <span class="code-comment">// æŸ¥è¯¢ç‰¹å®š NFT çš„æ‰€æœ‰è€…</span>
    <span class="code-keyword">function</span> <span class="code-function">ownerOf</span>(<span class="code-keyword">uint256</span> tokenId) <span class="code-keyword">external</span> <span class="code-keyword">view</span> <span class="code-keyword">returns</span> (<span class="code-keyword">address</span>);
    
    <span class="code-comment">// å®‰å…¨è½¬ç§» NFT æ‰€æœ‰æƒ</span>
    <span class="code-keyword">function</span> <span class="code-function">safeTransferFrom</span>(
        <span class="code-keyword">address</span> from,
        <span class="code-keyword">address</span> to,
        <span class="code-keyword">uint256</span> tokenId,
        <span class="code-keyword">bytes</span> <span class="code-keyword">memory</span> data
    ) <span class="code-keyword">external</span>;
    
    <span class="code-comment">// è½¬ç§» NFT æ‰€æœ‰æƒ</span>
    <span class="code-keyword">function</span> <span class="code-function">transferFrom</span>(
        <span class="code-keyword">address</span> from,
        <span class="code-keyword">address</span> to,
        <span class="code-keyword">uint256</span> tokenId
    ) <span class="code-keyword">external</span>;
    
    <span class="code-comment">// æˆæƒåœ°å€ç®¡ç†ç‰¹å®š NFT</span>
    <span class="code-keyword">function</span> <span class="code-function">approve</span>(<span class="code-keyword">address</span> to, <span class="code-keyword">uint256</span> tokenId) <span class="code-keyword">external</span>;
    
    <span class="code-comment">// è®¾ç½®æˆ–æ’¤é”€å…¨å±€æ“ä½œå‘˜</span>
    <span class="code-keyword">function</span> <span class="code-function">setApprovalForAll</span>(<span class="code-keyword">address</span> operator, <span class="code-keyword">bool</span> approved) <span class="code-keyword">external</span>;
    
    <span class="code-comment">// æŸ¥è¯¢ç‰¹å®š NFT çš„æˆæƒåœ°å€</span>
    <span class="code-keyword">function</span> <span class="code-function">getApproved</span>(<span class="code-keyword">uint256</span> tokenId) <span class="code-keyword">external</span> <span class="code-keyword">view</span> <span class="code-keyword">returns</span> (<span class="code-keyword">address</span>);
    
    <span class="code-comment">// æŸ¥è¯¢å…¨å±€æˆæƒçŠ¶æ€</span>
    <span class="code-keyword">function</span> <span class="code-function">isApprovedForAll</span>(<span class="code-keyword">address</span> owner, <span class="code-keyword">address</span> operator) <span class="code-keyword">external</span> <span class="code-keyword">view</span> <span class="code-keyword">returns</span> (<span class="code-keyword">bool</span>);
}</code></pre>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸçŠ¶æ€
        const nftState = {
            token1: {
                owner: "0x1234567890abcdef1234567890abcdef12345678",
                approved: "0x0000000000000000000000000000000000000000"
            },
            balances: {
                "0x1234567890abcdef1234567890abcdef12345678": 1,
                "0xabcdef1234567890abcdef1234567890abcdef12": 0
            },
            operatorApprovals: {}
        };
        
        // æ›´æ–°ä»£å¸å¯è§†åŒ–
        function updateTokenVisualization() {
            const tokenElement = document.querySelector('.token');
            tokenElement.querySelector('.token-owner').textContent = `æ‰€æœ‰è€…: ${shortenAddress(nftState.token1.owner)}`;
            
            const approvedAddress = nftState.token1.approved;
            if (approvedAddress !== "0x0000000000000000000000000000000000000000") {
                tokenElement.querySelector('.token-approved').textContent = `æˆæƒ: ${shortenAddress(approvedAddress)}`;
                tokenElement.querySelector('.token-approved').style.display = 'block';
            } else {
                tokenElement.querySelector('.token-approved').style.display = 'none';
            }
        }
        
        // ç¼©çŸ­åœ°å€æ˜¾ç¤º
        function shortenAddress(address) {
            return address.substring(0, 6) + "..." + address.substring(address.length - 4);
        }
        
        // åˆ‡æ¢æˆæƒå­—æ®µæ˜¾ç¤º
        function toggleApprovalFields() {
            const approvalType = document.getElementById('approveType').value;
            if (approvalType === 'single') {
                document.getElementById('singleApprovalFields').style.display = 'block';
                document.getElementById('allApprovalFields').style.display = 'none';
            } else {
                document.getElementById('singleApprovalFields').style.display = 'none';
                document.getElementById('allApprovalFields').style.display = 'block';
            }
        }
        
        // æŸ¥è¯¢åŠŸèƒ½
        function queryFunctions() {
            const ownerAddress = document.getElementById('ownerAddress').value;
            const tokenId = document.getElementById('tokenId').value;
            
            let result = "";
            
            // æ¨¡æ‹Ÿ balanceOf è°ƒç”¨
            const balance = nftState.balances[ownerAddress] || 0;
            result += `balanceOf(${shortenAddress(ownerAddress)}) = ${balance}\n\n`;
            
            // æ¨¡æ‹Ÿ ownerOf è°ƒç”¨
            if (tokenId === "1") {
                result += `ownerOf(${tokenId}) = ${shortenAddress(nftState.token1.owner)}\n\n`;
            } else {
                result += `ownerOf(${tokenId}) = é”™è¯¯: ä»£å¸ä¸å­˜åœ¨\n\n`;
            }
            
            // æ¨¡æ‹Ÿ getApproved è°ƒç”¨
            if (tokenId === "1") {
                result += `getApproved(${tokenId}) = ${shortenAddress(nftState.token1.approved)}\n\n`;
            } else {
                result += `getApproved(${tokenId}) = é”™è¯¯: ä»£å¸ä¸å­˜åœ¨\n\n`;
            }
            
            // æ¨¡æ‹Ÿ isApprovedForAll è°ƒç”¨
            const operator = "0x567890abcdef1234567890abcdef1234567890ab";
            const isApproved = nftState.operatorApprovals[ownerAddress]?.[operator] || false;
            result += `isApprovedForAll(${shortenAddress(ownerAddress)}, ${shortenAddress(operator)}) = ${isApproved}`;
            
            document.getElementById('queryResult').innerText = result;
            document.getElementById('queryResult').className = 'result success';
        }
        
        // è½¬ç§» NFT
        function transferNFT() {
            const fromAddress = document.getElementById('fromAddress').value;
            const toAddress = document.getElementById('toAddress').value;
            const tokenId = document.getElementById('transferTokenId').value;
            const transferType = document.getElementById('transferType').value;
            
            let result = "";
            
            if (tokenId !== "1") {
                result = `é”™è¯¯: ä»£å¸ ${tokenId} ä¸å­˜åœ¨`;
                document.getElementById('transferResult').className = 'result error';
                document.getElementById('transferResult').innerText = result;
                return;
            }
            
            if (nftState.token1.owner !== fromAddress) {
                result = `é”™è¯¯: åœ°å€ ${shortenAddress(fromAddress)} ä¸æ˜¯ä»£å¸çš„æ‰€æœ‰è€…`;
                document.getElementById('transferResult').className = 'result error';
                document.getElementById('transferResult').innerText = result;
                return;
            }
            
            // æ›´æ–°çŠ¶æ€
            nftState.token1.owner = toAddress;
            nftState.token1.approved = "0x0000000000000000000000000000000000000000"; // é‡ç½®æˆæƒ
            
            // æ›´æ–°ä½™é¢
            nftState.balances[fromAddress] = (nftState.balances[fromAddress] || 0) - 1;
            nftState.balances[toAddress] = (nftState.balances[toAddress] || 0) + 1;
            
            if (transferType === 'safeTransferFrom') {
                result = `safeTransferFrom è°ƒç”¨æˆåŠŸ:\nä» ${shortenAddress(fromAddress)}\nåˆ° ${shortenAddress(toAddress)}\nä»£å¸ ID: ${tokenId}\n\n`;
                result += `è½¬ç§»å·²å®Œæˆï¼`;
            } else {
                result = `transferFrom è°ƒç”¨æˆåŠŸ:\nä» ${shortenAddress(fromAddress)}\nåˆ° ${shortenAddress(toAddress)}\nä»£å¸ ID: ${tokenId}\n\n`;
                result += `è½¬ç§»å·²å®Œæˆï¼`;
            }
            
            document.getElementById('transferResult').className = 'result success';
            document.getElementById('transferResult').innerText = result;
            
            // æ›´æ–°å¯è§†åŒ–
            updateTokenVisualization();
        }
        
        // ç®¡ç†æˆæƒ
        function manageApproval() {
            const approvalType = document.getElementById('approveType').value;
            
            let result = "";
            
            if (approvalType === 'single') {
                const toAddress = document.getElementById('approveTo').value;
                const tokenId = document.getElementById('approveTokenId').value;
                
                if (tokenId !== "1") {
                    result = `é”™è¯¯: ä»£å¸ ${tokenId} ä¸å­˜åœ¨`;
                    document.getElementById('approvalResult').className = 'result error';
                    document.getElementById('approvalResult').innerText = result;
                    return;
                }
                
                nftState.token1.approved = toAddress;
                result = `approve è°ƒç”¨æˆåŠŸ:\næˆæƒåœ°å€: ${shortenAddress(toAddress)}\nä»£å¸ ID: ${tokenId}\n\n`;
                result += `ç°åœ¨ ${shortenAddress(toAddress)} å¯ä»¥ç®¡ç†æ­¤ NFT`;
            } else {
                const operator = document.getElementById('operator').value;
                const approvalStatus = document.getElementById('approvalStatus').value === 'true';
                const ownerAddress = nftState.token1.owner;
                
                // åˆå§‹åŒ–æ“ä½œå‘˜æ‰¹å‡†çŠ¶æ€
                if (!nftState.operatorApprovals[ownerAddress]) {
                    nftState.operatorApprovals[ownerAddress] = {};
                }
                
                nftState.operatorApprovals[ownerAddress][operator] = approvalStatus;
                
                result = `setApprovalForAll è°ƒç”¨æˆåŠŸ:\næ“ä½œå‘˜: ${shortenAddress(operator)}\nçŠ¶æ€: ${approvalStatus ? 'å·²æˆæƒ' : 'å·²æ’¤é”€'}\n\n`;
                result += `ç°åœ¨ ${shortenAddress(operator)} ${approvalStatus ? 'å¯ä»¥' : 'ä¸å†å¯ä»¥'}ç®¡ç† ${shortenAddress(ownerAddress)} çš„æ‰€æœ‰ NFT`;
            }
            
            document.getElementById('approvalResult').className = 'result success';
            document.getElementById('approvalResult').innerText = result;
            
            // æ›´æ–°å¯è§†åŒ–
            updateTokenVisualization();
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateTokenVisualization();
        });
    </script>
</body>
</html>
```

## ä½¿ç”¨è¯´æ˜

1. æŸ¥è¯¢åŠŸèƒ½
balanceOf(): æŸ¥è¯¢æŒ‡å®šåœ°å€æ‹¥æœ‰çš„NFTæ•°é‡

ownerOf(): æŸ¥è¯¢ç‰¹å®šNFTçš„æ‰€æœ‰è€…

getApproved(): æŸ¥è¯¢ç‰¹å®šNFTçš„æˆæƒåœ°å€

isApprovedForAll(): æŸ¥è¯¢å…¨å±€æˆæƒçŠ¶æ€

2. è½¬ç§»åŠŸèƒ½
transferFrom(): ç›´æ¥è½¬ç§»NFTæ‰€æœ‰æƒ

safeTransferFrom(): å®‰å…¨è½¬ç§»ï¼Œæ£€æŸ¥æ¥æ”¶æ–¹æ˜¯å¦ä¸ºåˆçº¦å¹¶å®ç°ERC721Receiveræ¥å£

3. æˆæƒåŠŸèƒ½
approve(): æˆæƒç‰¹å®šåœ°å€ç®¡ç†å•ä¸ªNFT

setApprovalForAll(): æˆæƒæˆ–æ’¤é”€åœ°å€ç®¡ç†æ‰€æœ‰NFTçš„æƒé™

## æœ€ä½³å®è·µ

ä¼˜å…ˆä½¿ç”¨safeTransferFromï¼šé˜²æ­¢NFTè¢«å‘é€åˆ°æ— æ³•å¤„ç†å®ƒä»¬çš„åˆçº¦

è½¬ç§»å‰æ£€æŸ¥æˆæƒï¼šç¡®ä¿è°ƒç”¨è€…æœ‰æƒé™è½¬ç§»NFT

é‡ç½®æˆæƒï¼šè½¬ç§»NFTåè‡ªåŠ¨é‡ç½®å•ä¸ªæˆæƒ

æ˜ç¡®æˆæƒèŒƒå›´ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©å•ä¸ªæˆæƒæˆ–å…¨å±€æˆæƒ

äº‹ä»¶é€šçŸ¥ï¼šæ‰€æœ‰çŠ¶æ€å˜æ›´éƒ½åº”è§¦å‘ç›¸åº”äº‹ä»¶

è¿™ä¸ªäº¤äº’å¼æ¼”ç¤ºæ¨¡æ‹Ÿäº†ERC721æ ¸å¿ƒåŠŸèƒ½çš„ä½¿ç”¨ï¼Œå¸®åŠ©æ‚¨ç†è§£å¦‚ä½•ä¸NFTæ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åƒethers.jsæˆ–web3.jsè¿™æ ·çš„åº“ä¸çœŸå®çš„ERC721åˆçº¦è¿›è¡Œäº¤äº’ã€‚
