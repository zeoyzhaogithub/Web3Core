# erc721

在 Solidity 中，ERC721 是以太坊上用于创建和管理非同质化代币（Non-Fungible Token, NFT）的标准智能合约接口。

它由 EIP-721（Ethereum Improvement Proposal 721）正式定义。理解 ERC721 的关键在于“非同质化”这个概念：

## 非同质化（Non-Fungible）

意味着每个代币都是独一无二的，具有独特性。

不可互换：一个 ERC721 代币不能简单地与另一个 ERC721 代币进行“1:1”交换，因为它们代表的是不同的东西，拥有不同的属性和价值。

与同质化代币（如 ERC20 代币或现实中的货币）形成鲜明对比。同质化代币是相同的，可以互相替代（例如，你的 1 ETH 和我的 1 ETH 价值相同，可以互换）。

## 代表独特资产

### 每个 ERC721 代币通常代表一个特定的、唯一的数字或物理资产的所有权或证明

### 常见应用场景包括

数字收藏品和艺术品：如 CryptoKitties, CryptoPunks, Bored Ape Yacht Club (BAYC) 等。

游戏内物品：独特的武器、皮肤、角色、虚拟土地等。

虚拟房地产：如 Decentraland 或 The Sandbox 中的地块。

域名系统：如 ENS（以太坊域名服务）的 .eth 域名。

现实世界资产的代币化：如独特的艺术品、收藏品、房产等的所有权证明（虽然需要链下法律框架配合）。

会员资格和门票：独特的访问权限证明。

身份和认证：独特的身份凭证。

## ERC721 标准的核心功能（接口）

Solidity 中的 ERC721 合约必须实现一组核心函数，以便钱包、交易所、市场和其他智能合约能够一致地与任何 NFT 进行交互。核心函数包括：

balanceOf(address _owner) external view returns (uint256): 查询指定地址拥有的代币数量。

ownerOf(uint256 _tokenId) external view returns (address): 查询指定代币 ID (_tokenId) 的当前所有者地址。

safeTransferFrom(address _from, address_to, uint256 _tokenId, bytes data) external payable: 安全地将代币所有权从一个地址转移到另一个地址。data 参数可选，通常为空。这个版本会检查接收地址是否是合约，如果是，则调用其 onERC721Received 函数，防止代币被永久锁定在无法处理它的合约中。

safeTransferFrom(address _from, address_to, uint256 _tokenId) external payable: 上面函数的重载，不带 data 参数。

transferFrom(address _from, address_to, uint256 _tokenId) external payable: 转移代币所有权（基本版本）。通常更推荐使用 safeTransferFrom。

approve(address _approved, uint256_tokenId) external payable: 授权另一个地址（操作员）代表你管理（转移）你拥有的特定代币。

setApprovalForAll(address _operator, bool_approved) external: 授权或撤销另一个地址（操作员）代表你管理（转移）你拥有的所有代币。

getApproved(uint256 _tokenId) external view returns (address): 查询被授权管理特定代币的地址（由 approve 设置）。

isApprovedForAll(address _owner, address_operator) external view returns (bool): 检查一个操作员是否被授权管理某个所有者拥有的所有代币（由 setApprovalForAll 设置）。

## 可选扩展接口

为了增强功能，ERC721 标准还定义了常用的可选扩展接口：

### ERC721Metadata

name() external view returns (string memory): 返回代币集合的名称（例如 "Bored Ape Yacht Club"）。

symbol() external view returns (string memory): 返回代币集合的符号（例如 "BAYC"）。

tokenURI(uint256 _tokenId) external view returns (string memory): 返回指向描述该特定代币的元数据 JSON 文件的 URI（通常是 HTTP 或 IPFS 链接）。这个 JSON 文件包含了代币的名称、描述、图像/媒体链接、属性（attributes）等关键信息。这是 NFT 项目最常见的扩展。

### ERC721Enumerable

提供遍历代币的功能，对于需要列出所有代币或用户代币的 DApp 很有用。

totalSupply() external view returns (uint256): 返回代币的总供应量（如果实现了）。

tokenByIndex(uint256 _index) external view returns (uint256): 按索引返回代币 ID。

tokenOfOwnerByIndex(address _owner, uint256_index) external view returns (uint256): 按索引返回指定所有者拥有的代币 ID。

## 事件（Events）

合约会在状态改变时触发事件，供外部监听：

Transfer(address indexed from, address indexed to, uint256 indexed tokenId): 当代币所有权转移时触发。

Approval(address indexed owner, address indexed approved, uint256 indexed tokenId): 当使用 approve 为特定代币设置授权时触发。

ApprovalForAll(address indexed owner, address indexed operator, bool approved): 当使用 setApprovalForAll 设置或撤销全局操作员授权时触发。

## 总结

在 Solidity 的上下文中，ERC721 是一个标准规范（一组必须实现的函数和事件）。开发者通过编写符合这个规范的智能合约来创建自己的 NFT 项目。它确保了所有基于 ERC721 的 NFT 都能被兼容的钱包（如 MetaMask）、市场（如 OpenSea, Blur）和其他应用程序以一致的方式识别、展示、转移和交易，极大地促进了 NFT 生态系统的互操作性和繁荣。

你可以把它看作是创建独特数字物品（NFT）的“蓝图”或“规则手册”，任何遵循这些规则编写的 Solidity 合约都能生产出被整个以太坊 NFT 生态系统理解的代币。

---

# ERC721标准核心功能使用指南

ERC721是以太坊上用于非同质化代币(NFT)的标准接口。下面我将通过一个交互式示例展示ERC721核心功能的使用方法。

## ERC721核心功能概述

以下是ERC721标准的核心功能及其使用方法：

功能| 方法签名| 描述
|---|-------|----|
查询余额| balanceOf(address owner) |查询指定地址拥有的NFT数量
查询所有者| ownerOf(uint256 tokenId)| 查询特定NFT的所有者
转移代币| transferFrom(address from, address to, uint256 tokenId) |转移NFT所有权
安全转移| safeTransferFrom(address from, address to, uint256 tokenId)| 安全转移(检查接收合约)
授权管理| approve(address to, uint256 tokenId)| 授权地址管理特定NFT
全局授权 |setApprovalForAll(address operator, bool approved) |授权/撤销地址管理所有NFT
查询授权| getApproved(uint256 tokenId) |查询特定NFT的授权地址
查询全局授权| isApprovedForAll(address owner, address operator) |查询全局授权状态

## 交互式示例

```html

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERC721核心功能演示</title>
    <style>
        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --dark: #1a1c2c;
            --light: #f5f5f7;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            padding: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.5);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            align-items: center;
        }
        
        .card h2 i {
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .function-demo {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        button {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary);
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .token-visualization {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .token {
            width: 120px;
            height: 160px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .token-id {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .token-owner {
            font-size: 14px;
            text-align: center;
            background: rgba(0,0,0,0.3);
            padding: 4px 8px;
            border-radius: 20px;
        }
        
        .token-approved {
            position: absolute;
            bottom: 10px;
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
        }
        
        .success {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }
        
        .error {
            background-color: rgba(244, 67, 54, 0.2);
            color: var(--error);
        }
        
        .info {
            background-color: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
        }
        
        .code-comment {
            color: #75715e;
        }
        
        .code-keyword {
            color: #f92672;
        }
        
        .code-function {
            color: #66d9ef;
        }
        
        .code-var {
            color: #fd971f;
        }
        
        .code-string {
            color: #e6db74;
        }
        
        @media (max-width: 768px) {
            .cards-container {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            header p {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ERC721 核心功能演示</h1>
            <p>了解如何通过智能合约交互使用 ERC721 标准的核心功能，包括 NFT 的转移、授权和查询操作。</p>
        </header>

        <div class="token-visualization">
            <div class="token">
                <div class="token-id">NFT #1</div>
                <div class="token-owner">所有者: 0x1234...abcd</div>
                <div class="token-approved">授权: 0x5678...ef01</div>
            </div>
        </div>
        
        <div class="cards-container">
            <!-- 查询功能 -->
            <div class="card">
                <h2>📋 查询功能</h2>
                <p>查询 NFT 的所有权和余额信息</p>
                
                <div class="function-demo">
                    <div class="input-group">
                        <label for="ownerAddress">所有者地址</label>
                        <input type="text" id="ownerAddress" value="0x1234567890abcdef1234567890abcdef12345678">
                    </div>
                    
                    <div class="input-group">
                        <label for="tokenId">代币 ID</label>
                        <input type="text" id="tokenId" value="1">
                    </div>
                    
                    <button onclick="queryFunctions()">执行查询</button>
                    
                    <div class="result" id="queryResult">
                        {/* 结果将显示在这里 */}
                    </div>
                </div>
            </div>
            
            <!-- 转移功能 -->
            <div class="card">
                <h2>🔄 转移功能</h2>
                <p>转移 NFT 的所有权</p>
                
                <div class="function-demo">
                    <div class="input-group">
                        <label for="fromAddress">发送方地址</label>
                        <input type="text" id="fromAddress" value="0x1234567890abcdef1234567890abcdef12345678">
                    </div>
                    
                    <div class="input-group">
                        <label for="toAddress">接收方地址</label>
                        <input type="text" id="toAddress" value="0xabcdef1234567890abcdef1234567890abcdef12">
                    </div>
                    
                    <div class="input-group">
                        <label for="transferTokenId">代币 ID</label>
                        <input type="text" id="transferTokenId" value="1">
                    </div>
                    
                    <div class="input-group">
                        <label for="transferType">转移类型</label>
                        <select id="transferType">
                            <option value="transferFrom">transferFrom</option>
                            <option value="safeTransferFrom">safeTransferFrom</option>
                        </select>
                    </div>
                    
                    <button onclick="transferNFT()">转移 NFT</button>
                    
                    <div class="result" id="transferResult">
                        {/* 结果将显示在这里 */}
                    </div>
                </div>
            </div>
            
            <!-- 授权功能 -->
            <div class="card">
                <h2>🔑 授权功能</h2>
                <p>授权其他地址管理您的 NFT</p>
                
                <div class="function-demo">
                    <div class="input-group">
                        <label for="approveType">授权类型</label>
                        <select id="approveType" onchange="toggleApprovalFields()">
                            <option value="single">单个授权 (approve)</option>
                            <option value="all">全局授权 (setApprovalForAll)</option>
                        </select>
                    </div>
                    
                    <div id="singleApprovalFields">
                        <div class="input-group">
                            <label for="approveTo">授权地址</label>
                            <input type="text" id="approveTo" value="0x567890abcdef1234567890abcdef1234567890ab">
                        </div>
                        
                        <div class="input-group">
                            <label for="approveTokenId">代币 ID</label>
                            <input type="text" id="approveTokenId" value="1">
                        </div>
                    </div>
                    
                    <div id="allApprovalFields" style="display:none;">
                        <div class="input-group">
                            <label for="operator">操作员地址</label>
                            <input type="text" id="operator" value="0x567890abcdef1234567890abcdef1234567890ab">
                        </div>
                        
                        <div class="input-group">
                            <label for="approvalStatus">授权状态</label>
                            <select id="approvalStatus">
                                <option value="true">授权</option>
                                <option value="false">撤销授权</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="manageApproval()">执行授权</button>
                    
                    <div class="result" id="approvalResult">
                        {/* 结果将显示在这里 */}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="code-block">
            <pre><code><span class="code-comment">// ERC721 核心功能 Solidity 接口</span>
<span class="code-keyword">interface</span> <span class="code-function">IERC721</span> {
    <span class="code-comment">// 查询所有者拥有的 NFT 数量</span>
    <span class="code-keyword">function</span> <span class="code-function">balanceOf</span>(<span class="code-keyword">address</span> owner) <span class="code-keyword">external</span> <span class="code-keyword">view</span> <span class="code-keyword">returns</span> (<span class="code-keyword">uint256</span>);

    <span class="code-comment">// 查询特定 NFT 的所有者</span>
    <span class="code-keyword">function</span> <span class="code-function">ownerOf</span>(<span class="code-keyword">uint256</span> tokenId) <span class="code-keyword">external</span> <span class="code-keyword">view</span> <span class="code-keyword">returns</span> (<span class="code-keyword">address</span>);
    
    <span class="code-comment">// 安全转移 NFT 所有权</span>
    <span class="code-keyword">function</span> <span class="code-function">safeTransferFrom</span>(
        <span class="code-keyword">address</span> from,
        <span class="code-keyword">address</span> to,
        <span class="code-keyword">uint256</span> tokenId,
        <span class="code-keyword">bytes</span> <span class="code-keyword">memory</span> data
    ) <span class="code-keyword">external</span>;
    
    <span class="code-comment">// 转移 NFT 所有权</span>
    <span class="code-keyword">function</span> <span class="code-function">transferFrom</span>(
        <span class="code-keyword">address</span> from,
        <span class="code-keyword">address</span> to,
        <span class="code-keyword">uint256</span> tokenId
    ) <span class="code-keyword">external</span>;
    
    <span class="code-comment">// 授权地址管理特定 NFT</span>
    <span class="code-keyword">function</span> <span class="code-function">approve</span>(<span class="code-keyword">address</span> to, <span class="code-keyword">uint256</span> tokenId) <span class="code-keyword">external</span>;
    
    <span class="code-comment">// 设置或撤销全局操作员</span>
    <span class="code-keyword">function</span> <span class="code-function">setApprovalForAll</span>(<span class="code-keyword">address</span> operator, <span class="code-keyword">bool</span> approved) <span class="code-keyword">external</span>;
    
    <span class="code-comment">// 查询特定 NFT 的授权地址</span>
    <span class="code-keyword">function</span> <span class="code-function">getApproved</span>(<span class="code-keyword">uint256</span> tokenId) <span class="code-keyword">external</span> <span class="code-keyword">view</span> <span class="code-keyword">returns</span> (<span class="code-keyword">address</span>);
    
    <span class="code-comment">// 查询全局授权状态</span>
    <span class="code-keyword">function</span> <span class="code-function">isApprovedForAll</span>(<span class="code-keyword">address</span> owner, <span class="code-keyword">address</span> operator) <span class="code-keyword">external</span> <span class="code-keyword">view</span> <span class="code-keyword">returns</span> (<span class="code-keyword">bool</span>);
}</code></pre>
        </div>
    </div>

    <script>
        // 模拟状态
        const nftState = {
            token1: {
                owner: "0x1234567890abcdef1234567890abcdef12345678",
                approved: "0x0000000000000000000000000000000000000000"
            },
            balances: {
                "0x1234567890abcdef1234567890abcdef12345678": 1,
                "0xabcdef1234567890abcdef1234567890abcdef12": 0
            },
            operatorApprovals: {}
        };
        
        // 更新代币可视化
        function updateTokenVisualization() {
            const tokenElement = document.querySelector('.token');
            tokenElement.querySelector('.token-owner').textContent = `所有者: ${shortenAddress(nftState.token1.owner)}`;
            
            const approvedAddress = nftState.token1.approved;
            if (approvedAddress !== "0x0000000000000000000000000000000000000000") {
                tokenElement.querySelector('.token-approved').textContent = `授权: ${shortenAddress(approvedAddress)}`;
                tokenElement.querySelector('.token-approved').style.display = 'block';
            } else {
                tokenElement.querySelector('.token-approved').style.display = 'none';
            }
        }
        
        // 缩短地址显示
        function shortenAddress(address) {
            return address.substring(0, 6) + "..." + address.substring(address.length - 4);
        }
        
        // 切换授权字段显示
        function toggleApprovalFields() {
            const approvalType = document.getElementById('approveType').value;
            if (approvalType === 'single') {
                document.getElementById('singleApprovalFields').style.display = 'block';
                document.getElementById('allApprovalFields').style.display = 'none';
            } else {
                document.getElementById('singleApprovalFields').style.display = 'none';
                document.getElementById('allApprovalFields').style.display = 'block';
            }
        }
        
        // 查询功能
        function queryFunctions() {
            const ownerAddress = document.getElementById('ownerAddress').value;
            const tokenId = document.getElementById('tokenId').value;
            
            let result = "";
            
            // 模拟 balanceOf 调用
            const balance = nftState.balances[ownerAddress] || 0;
            result += `balanceOf(${shortenAddress(ownerAddress)}) = ${balance}\n\n`;
            
            // 模拟 ownerOf 调用
            if (tokenId === "1") {
                result += `ownerOf(${tokenId}) = ${shortenAddress(nftState.token1.owner)}\n\n`;
            } else {
                result += `ownerOf(${tokenId}) = 错误: 代币不存在\n\n`;
            }
            
            // 模拟 getApproved 调用
            if (tokenId === "1") {
                result += `getApproved(${tokenId}) = ${shortenAddress(nftState.token1.approved)}\n\n`;
            } else {
                result += `getApproved(${tokenId}) = 错误: 代币不存在\n\n`;
            }
            
            // 模拟 isApprovedForAll 调用
            const operator = "0x567890abcdef1234567890abcdef1234567890ab";
            const isApproved = nftState.operatorApprovals[ownerAddress]?.[operator] || false;
            result += `isApprovedForAll(${shortenAddress(ownerAddress)}, ${shortenAddress(operator)}) = ${isApproved}`;
            
            document.getElementById('queryResult').innerText = result;
            document.getElementById('queryResult').className = 'result success';
        }
        
        // 转移 NFT
        function transferNFT() {
            const fromAddress = document.getElementById('fromAddress').value;
            const toAddress = document.getElementById('toAddress').value;
            const tokenId = document.getElementById('transferTokenId').value;
            const transferType = document.getElementById('transferType').value;
            
            let result = "";
            
            if (tokenId !== "1") {
                result = `错误: 代币 ${tokenId} 不存在`;
                document.getElementById('transferResult').className = 'result error';
                document.getElementById('transferResult').innerText = result;
                return;
            }
            
            if (nftState.token1.owner !== fromAddress) {
                result = `错误: 地址 ${shortenAddress(fromAddress)} 不是代币的所有者`;
                document.getElementById('transferResult').className = 'result error';
                document.getElementById('transferResult').innerText = result;
                return;
            }
            
            // 更新状态
            nftState.token1.owner = toAddress;
            nftState.token1.approved = "0x0000000000000000000000000000000000000000"; // 重置授权
            
            // 更新余额
            nftState.balances[fromAddress] = (nftState.balances[fromAddress] || 0) - 1;
            nftState.balances[toAddress] = (nftState.balances[toAddress] || 0) + 1;
            
            if (transferType === 'safeTransferFrom') {
                result = `safeTransferFrom 调用成功:\n从 ${shortenAddress(fromAddress)}\n到 ${shortenAddress(toAddress)}\n代币 ID: ${tokenId}\n\n`;
                result += `转移已完成！`;
            } else {
                result = `transferFrom 调用成功:\n从 ${shortenAddress(fromAddress)}\n到 ${shortenAddress(toAddress)}\n代币 ID: ${tokenId}\n\n`;
                result += `转移已完成！`;
            }
            
            document.getElementById('transferResult').className = 'result success';
            document.getElementById('transferResult').innerText = result;
            
            // 更新可视化
            updateTokenVisualization();
        }
        
        // 管理授权
        function manageApproval() {
            const approvalType = document.getElementById('approveType').value;
            
            let result = "";
            
            if (approvalType === 'single') {
                const toAddress = document.getElementById('approveTo').value;
                const tokenId = document.getElementById('approveTokenId').value;
                
                if (tokenId !== "1") {
                    result = `错误: 代币 ${tokenId} 不存在`;
                    document.getElementById('approvalResult').className = 'result error';
                    document.getElementById('approvalResult').innerText = result;
                    return;
                }
                
                nftState.token1.approved = toAddress;
                result = `approve 调用成功:\n授权地址: ${shortenAddress(toAddress)}\n代币 ID: ${tokenId}\n\n`;
                result += `现在 ${shortenAddress(toAddress)} 可以管理此 NFT`;
            } else {
                const operator = document.getElementById('operator').value;
                const approvalStatus = document.getElementById('approvalStatus').value === 'true';
                const ownerAddress = nftState.token1.owner;
                
                // 初始化操作员批准状态
                if (!nftState.operatorApprovals[ownerAddress]) {
                    nftState.operatorApprovals[ownerAddress] = {};
                }
                
                nftState.operatorApprovals[ownerAddress][operator] = approvalStatus;
                
                result = `setApprovalForAll 调用成功:\n操作员: ${shortenAddress(operator)}\n状态: ${approvalStatus ? '已授权' : '已撤销'}\n\n`;
                result += `现在 ${shortenAddress(operator)} ${approvalStatus ? '可以' : '不再可以'}管理 ${shortenAddress(ownerAddress)} 的所有 NFT`;
            }
            
            document.getElementById('approvalResult').className = 'result success';
            document.getElementById('approvalResult').innerText = result;
            
            // 更新可视化
            updateTokenVisualization();
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            updateTokenVisualization();
        });
    </script>
</body>
</html>
```

## 使用说明

1. 查询功能
balanceOf(): 查询指定地址拥有的NFT数量

ownerOf(): 查询特定NFT的所有者

getApproved(): 查询特定NFT的授权地址

isApprovedForAll(): 查询全局授权状态

2. 转移功能
transferFrom(): 直接转移NFT所有权

safeTransferFrom(): 安全转移，检查接收方是否为合约并实现ERC721Receiver接口

3. 授权功能
approve(): 授权特定地址管理单个NFT

setApprovalForAll(): 授权或撤销地址管理所有NFT的权限

## 最佳实践

优先使用safeTransferFrom：防止NFT被发送到无法处理它们的合约

转移前检查授权：确保调用者有权限转移NFT

重置授权：转移NFT后自动重置单个授权

明确授权范围：根据需求选择单个授权或全局授权

事件通知：所有状态变更都应触发相应事件

这个交互式演示模拟了ERC721核心功能的使用，帮助您理解如何与NFT智能合约进行交互。在实际开发中，您可以使用像ethers.js或web3.js这样的库与真实的ERC721合约进行交互。
