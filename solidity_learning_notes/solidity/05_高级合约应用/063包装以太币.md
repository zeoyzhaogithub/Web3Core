# 包装以太币（WETH）

## 概念

包装以太币（WETH） 是将原生以太币（ETH）转换为符合 ERC-20 标准的代币的机制。由于原生 ETH 不符合 ERC-20 标准，在 DeFi 应用中无法直接与其他代币交互。WETH 通过 1:1 锚定 ETH 解决这一问题。

## 核心功能

### 存款（Deposit）

用户将 ETH 存入合约，获得等量 WETH

### 取款（Withdraw）

销毁 WETH，取回等量 ETH

### ERC-20 兼容

转账 (transfer)

授权 (approve)

授权转账 (transferFrom)

## 实现步骤

实现 ERC-20 标准接口

创建 deposit() 接收 ETH 并铸造 WETH

创建 withdraw(uint) 销毁 WETH 并返回 ETH

添加 receive() 函数处理直接转账

## 完整合约代码

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

contract WETH is ERC20 {
    // 事件声明
    event Deposit(address indexed account, uint amount);
    event Withdrawal(address indexed account, uint amount);

    // 初始化代币
    constructor() ERC20("Wrapped Ether", "WETH") {}

    // 存款函数（接收ETH并铸造WETH）
    function deposit() public payable {
        _mint(msg.sender, msg.value);
        emit Deposit(msg.sender, msg.value);
    }

    // 取款函数（销毁WETH并返回ETH）
    function withdraw(uint amount) public {
        require(balanceOf(msg.sender) >= amount, "Insufficient balance");
        _burn(msg.sender, amount);
        payable(msg.sender).transfer(amount);
        emit Withdrawal(msg.sender, amount);
    }

    // 接收ETH的回退函数
    receive() external payable {
        deposit();
    }
}
```

## 关键功能说明

### 存款流程

```solidity
function deposit() public payable {
    _mint(msg.sender, msg.value); // 铸造等量WETH
    emit Deposit(msg.sender, msg.value);
}
```

- 用户发送 ETH 调用 deposit()
- 合约铸造等量 WETH 到用户地址
- 触发 Deposit 事件

### 取款流程

```solidity
function withdraw(uint amount) public {
    _burn(msg.sender, amount); // 销毁用户WETH
    payable(msg.sender).transfer(amount); // 返回等量ETH
    emit Withdrawal(msg.sender, amount);
}
```

- 用户指定要销毁的 WETH 数量
- 合约销毁代币并发送等量 ETH
- 触发 Withdrawal 事件

### ERC-20 集成

- 继承 OpenZeppelin 的 ERC-20 实现
- 自动获得转账/授权等标准功能
- 小数位数固定为 18（与 ETH 一致）

### 直接转账处理

```solidity
receive() external payable {
    deposit(); // 自动调用存款逻辑
}
```

- 用户直接向合约地址发送 ETH 时自动存款

## 使用示例

```solidity
// 存款
function wrapETH() public payable {
    WETH(wethAddress).deposit{value: msg.value}();
}

// 取款
function unwrapETH(uint amount) public {
    WETH(wethAddress).withdraw(amount);
}
```

## 安全特性

取款前余额检查 (require(balanceOf...))

使用 OpenZeppelin 的安全 ERC-20 实现

转账使用 transfer() 而非 send()/call()

实际应用：WETH 是 Uniswap、Compound 等 DeFi 协议的基础组件，用户需先将 ETH 转为 WETH 才能参与交易、借贷等操作。
